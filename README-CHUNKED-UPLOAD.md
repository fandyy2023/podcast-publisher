# Чанковая загрузка больших файлов

## Проблема
Cloudflare ограничивает размер одного HTTP-запроса до 100 МБ. При загрузке аудиофайлов для подкаста это ограничение может стать проблемой, так как эпизоды часто превышают этот размер.

## Решение
Реализована система чанковой (фрагментированной) загрузки файлов:

1. **Принцип работы:**
   - Большие файлы разбиваются на маленькие фрагменты (до 10 МБ каждый)
   - Каждый фрагмент отправляется отдельным HTTP-запросом
   - Сервер собирает фрагменты в единый файл
   - Не требует Caddy, прямого доступа к портам или белого IP

2. **Компоненты решения:**
   - Backend API для приема, хранения и сборки фрагментов
   - Frontend JavaScript для разбиения файлов и отслеживания процесса загрузки
   - Интеграция с существующей системой создания эпизодов

## Как это работает

### Backend
Добавлены новые API-эндпоинты:

- `POST /api/upload/chunk`: Принимает один фрагмент файла
- `POST /api/upload/complete`: Объединяет фрагменты в итоговый файл
- `GET /api/upload/status`: Проверяет статус загрузки
- `POST /api/upload/cleanup`: Очищает старые/незавершенные загрузки

Временные файлы хранятся в директории `tmp_uploads`.

### Frontend
JavaScript-библиотека `chunked-uploader.js`:
- Автоматически разбивает большие файлы на части
- Показывает прогресс загрузки
- Поддерживает повторные попытки при сбоях
- Интегрируется с формой создания эпизода

## Использование

Обычное поведение для пользователя:

1. При загрузке файла размером до 100 МБ - стандартная загрузка
2. При загрузке файла размером более 100 МБ - автоматически включается чанковая загрузка:
   - Показывается индикатор прогресса
   - Кнопка "Создать эпизод" блокируется до завершения загрузки
   - После завершения загрузки форма отправляется как обычно

## Технические детали

- **Размер чанка:** 8-10 МБ (настраивается)
- **Идентификация загрузки:** Каждой загрузке присваивается уникальный ID
- **Параллелизм:** Одновременно может загружаться до 3-х чанков
- **Хранение:** Временные файлы удаляются через 24 часа

## Безопасность

- Применяется `secure_filename` для защиты от path traversal
- Используется проверка хэша файла для подтверждения целостности
- Временные файлы доступны только через API эндпоинты
